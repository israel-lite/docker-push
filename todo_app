from fastapi import FastAPI
from pydantic import BaseModel
from datetime import datetime

app = FastAPI(title="Todo List API")

class TaskCreate(BaseModel):
    title: str

class Task(TaskCreate):
    id: int
    created_at: datetime
    updated_at: datetime
    is_completed: bool

# Simulated in-memory database
tasks_db = []
id_counter = 1

@app.get("/")
def root():
    return {"message": "Welcome to Wolong’s Todo API 🐉"}


@app.post("/tasks/", response_model=Task)
def create_task(task: TaskCreate):
    global id_counter
    new_task = Task(
        id=id_counter,
        title=task.title,
        created_at=datetime.utcnow(),
        updated_at=datetime.utcnow(),
        is_completed=False
    )
    tasks_db.append(new_task)
    id_counter += 1
    return new_task

@app.get("/tasks/", response_model=list[Task])
def read_tasks():
    return tasks_db

@app.get("/tasks/{task_id}", response_model=Task)
def read_task(task_id: int):
    for task in tasks_db:
        if task.id == task_id:
            return task
    return {"error": "Task not found"}

@app.put("/tasks/{task_id}", response_model=Task)
def update_task(task_id: int, updated_task: TaskCreate):
    for task in tasks_db:
        if task.id == task_id:
            task.title = updated_task.title
            task.updated_at = datetime.utcnow()
            return task
    return {"error": "Task not found"}